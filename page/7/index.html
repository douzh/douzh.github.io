<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>OneKBase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="OneKBase">
<meta property="og:url" content="http://www.onekbase.com/page/7/index.html">
<meta property="og:site_name" content="OneKBase">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="证心">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="OneKBase" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">OneKBase</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.onekbase.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-blog/bigdata/spark/sparkdiary/rddapi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/bigdata/spark/sparkdiary/rddapi/" class="article-date">
  <time datetime="2017-06-12T10:42:43.000Z" itemprop="datePublished">2017-06-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>►<a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/spark/">spark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/bigdata/spark/sparkdiary/rddapi/">(转)Spark RDD API详解(一) Map和Reduce</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="RDD是什么？"><a href="#RDD是什么？" class="headerlink" title="RDD是什么？"></a>RDD是什么？</h2><p>RDD是Spark中的抽象数据结构类型，任何数据在Spark中都被表示为RDD。从编程的角度来看，RDD可以简单看成是一个数组。和普通数组的区别是，RDD中的数据是分区存储的，这样不同分区的数据就可以分布在不同的机器上，同时可以被并行处理。因此，Spark应用程序所做的无非是把需要处理的数据转换为RDD，然后对RDD进行一系列的变换和操作从而得到结果。本文为第一部分，将介绍Spark RDD中与Map和Reduce相关的API中。</p>
<h2 id="如何创建RDD？"><a href="#如何创建RDD？" class="headerlink" title="如何创建RDD？"></a>如何创建RDD？</h2><p>RDD可以从普通数组创建出来，也可以从文件系统或者HDFS中的文件创建出来。</p>
<p>举例：从普通数组创建RDD，里面包含了1到9这9个数字，它们分别在3个分区中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(1 to 9, 3)</span><br><span class="line">a: org.apache.spark.rdd.RDD[Int] = ParallelCollectionRDD[1] at parallelize at &lt;console&gt;:12</span><br></pre></td></tr></table></figure>
<p>举例：读取文件README.md来创建RDD，文件中的每一行就是RDD中的一个元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val b = sc.textFile(&quot;README.md&quot;)</span><br><span class="line">b: org.apache.spark.rdd.RDD[String] = MappedRDD[3] at textFile at &lt;console&gt;:12</span><br></pre></td></tr></table></figure>
<p>虽然还有别的方式可以创建RDD，但在本文中我们主要使用上述两种方式来创建RDD以说明RDD的API。</p>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><p>map是对RDD中的每个元素都执行一个指定的函数来产生一个新的RDD。任何原RDD中的元素在新RDD中都有且只有一个元素与之对应。</p>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(1 to 9, 3)</span><br><span class="line">scala&gt; val b = a.map(x =&gt; x*2)</span><br><span class="line">scala&gt; a.collect</span><br><span class="line">res10: Array[Int] = Array(1, 2, 3, 4, 5, 6, 7, 8, 9)</span><br><span class="line">scala&gt; b.collect</span><br><span class="line">res11: Array[Int] = Array(2, 4, 6, 8, 10, 12, 14, 16, 18)</span><br></pre></td></tr></table></figure>
<p>上述例子中把原RDD中每个元素都乘以2来产生一个新的RDD。</p>
<h2 id="mapPartitions"><a href="#mapPartitions" class="headerlink" title="mapPartitions"></a>mapPartitions</h2><p>mapPartitions是map的一个变种。map的输入函数是应用于RDD中每个元素，而mapPartitions的输入函数是应用于每个分区，也就是把每个分区中的内容作为整体来处理的。<br>它的函数定义为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def mapPartitions[U: ClassTag](f: Iterator[T] =&gt; Iterator[U], preservesPartitioning: Boolean = false): RDD[U]</span><br></pre></td></tr></table></figure>
<p>f即为输入函数，它处理每个分区里面的内容。每个分区中的内容将以Iterator[T]传递给输入函数f，f的输出结果是Iterator[U]。最终的RDD由所有分区经过输入函数处理后的结果合并起来的。</p>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(1 to 9, 3)</span><br><span class="line">scala&gt; def myfunc[T](iter: Iterator[T]) : Iterator[(T, T)] = &#123;</span><br><span class="line">    var res = List[(T, T)]() </span><br><span class="line">    var pre = iter.next while (iter.hasNext) &#123;</span><br><span class="line">        val cur = iter.next; </span><br><span class="line">        res .::= (pre, cur) pre = cur;</span><br><span class="line">    &#125; </span><br><span class="line">    res.iterator</span><br><span class="line">&#125;</span><br><span class="line">scala&gt; a.mapPartitions(myfunc).collect</span><br><span class="line">res0: Array[(Int, Int)] = Array((2,3), (1,2), (5,6), (4,5), (8,9), (7,8))</span><br></pre></td></tr></table></figure>
<p>上述例子中的函数myfunc是把分区中一个元素和它的下一个元素组成一个Tuple。因为分区中最后一个元素没有下一个元素了，所以(3,4)和(6,7)不在结果中。</p>
<p>mapPartitions还有些变种，比如mapPartitionsWithContext，它能把处理过程中的一些状态信息传递给用户指定的输入函数。还有mapPartitionsWithIndex，它能把分区的index传递给用户指定的输入函数。</p>
<h2 id="mapValues"><a href="#mapValues" class="headerlink" title="mapValues"></a>mapValues</h2><p>mapValues顾名思义就是输入函数应用于RDD中Kev-Value的Value，原RDD中的Key保持不变，与新的Value一起组成新的RDD中的元素。因此，该函数只适用于元素为KV对的RDD。</p>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(List(&quot;dog&quot;, &quot;tiger&quot;, &quot;lion&quot;, &quot;cat&quot;, &quot;panther&quot;, &quot; eagle&quot;), 2)</span><br><span class="line">scala&gt; val b = a.map(x =&gt; (x.length, x))</span><br><span class="line">scala&gt; b.mapValues(&quot;x&quot; + _ + &quot;x&quot;).collect</span><br><span class="line">res5: Array[(Int, String)] = Array((3,xdogx), (5,xtigerx), (4,xlionx),(3,xcatx), (7,xpantherx), (5,xeaglex))</span><br></pre></td></tr></table></figure>

<h2 id="mapWith"><a href="#mapWith" class="headerlink" title="mapWith"></a>mapWith</h2><p>mapWith是map的另外一个变种，map只需要一个输入函数，而mapWith有两个输入函数。它的定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def mapWith[A: ClassTag, U: ](constructA: Int =&gt; A, preservesPartitioning: Boolean = false)(f: (T, A) =&gt; U): RDD[U]</span><br></pre></td></tr></table></figure>
<p>第一个函数constructA是把RDD的partition index（index从0开始）作为输入，输出为新类型A；<br>第二个函数f是把二元组(T, A)作为输入（其中T为原RDD中的元素，A为第一个函数的输出），输出类型为U。</p>
<p>举例：把partition index 乘以10，然后加上2作为新的RDD的元素。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val x = sc.parallelize(List(1,2,3,4,5,6,7,8,9,10), 3) </span><br><span class="line">x.mapWith(a =&gt; a * 10)((a, b) =&gt; (b + 2)).collect </span><br><span class="line">res4: Array[Int] = Array(2, 2, 2, 12, 12, 12, 22, 22, 22, 22)</span><br><span class="line">flatMap</span><br></pre></td></tr></table></figure>
<p>与map类似，区别是原RDD中的元素经map处理后只能生成一个元素，而原RDD中的元素经flatmap处理后可生成多个元素来构建新RDD。</p>
<p>举例：对原RDD中的每个元素x产生y个元素（从1到y，y为元素x的值）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(1 to 4, 2)</span><br><span class="line">scala&gt; val b = a.flatMap(x =&gt; 1 to x)</span><br><span class="line">scala&gt; b.collect</span><br><span class="line">res12: Array[Int] = Array(1, 1, 2, 1, 2, 3, 1, 2, 3, 4)</span><br></pre></td></tr></table></figure>

<h2 id="flatMapWith"><a href="#flatMapWith" class="headerlink" title="flatMapWith"></a>flatMapWith</h2><p>flatMapWith与mapWith很类似，都是接收两个函数，一个函数把partitionIndex作为输入，输出是一个新类型A；另外一个函数是以二元组（T,A）作为输入，输出为一个序列，这些序列里面的元素组成了新的RDD。它的定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def flatMapWith[A: ClassTag, U: ClassTag](constructA: Int =&gt; A, preservesPartitioning: Boolean = false)(f: (T, A) =&gt; Seq[U]): RDD[U]</span><br></pre></td></tr></table></figure>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(List(1,2,3,4,5,6,7,8,9), 3)</span><br><span class="line">scala&gt; a.flatMapWith(x =&gt; x, true)((x, y) =&gt; List(y, x)).collect</span><br><span class="line">res58: Array[Int] = Array(0, 1, 0, 2, 0, 3, 1, 4, 1, 5, 1, 6, 2, 7, 2,</span><br><span class="line">8, 2, 9)</span><br></pre></td></tr></table></figure>
<h2 id="flatMapValues"><a href="#flatMapValues" class="headerlink" title="flatMapValues"></a>flatMapValues</h2><p>flatMapValues类似于mapValues，不同的在于flatMapValues应用于元素为KV对的RDD中Value。每个一元素的Value被输入函数映射为一系列的值，然后这些值再与原RDD中的Key组成一系列新的KV对。</p>
<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(List((1,2),(3,4),(3,6)))</span><br><span class="line">scala&gt; val b = a.flatMapValues(x=&gt;x.to(5))</span><br><span class="line">scala&gt; b.collect</span><br><span class="line">res3: Array[(Int, Int)] = Array((1,2), (1,3), (1,4), (1,5), (3,4), (3,5))</span><br></pre></td></tr></table></figure>

<p>上述例子中原RDD中每个元素的值被转换为一个序列（从其当前值到5），比如第一个KV对(1,2), 其值2被转换为2，3，4，5。然后其再与原KV对中Key组成一系列新的KV对(1,2),(1,3),(1,4),(1,5)。</p>
<h2 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h2><p>reduce将RDD中元素两两传递给输入函数，同时产生一个新的值，新产生的值与RDD中下一个元素再被传递给输入函数直到最后只有一个值为止。</p>
<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val c = sc.parallelize(1 to 10)</span><br><span class="line">scala&gt; c.reduce((x, y) =&gt; x + y)</span><br><span class="line">res4: Int = 55</span><br></pre></td></tr></table></figure>

<p>上述例子对RDD中的元素求和。</p>
<h2 id="reduceByKey"><a href="#reduceByKey" class="headerlink" title="reduceByKey"></a>reduceByKey</h2><p>顾名思义，reduceByKey就是对元素为KV对的RDD中Key相同的元素的Value进行reduce，因此，Key相同的多个元素的值被reduce为一个值，然后与原RDD中的Key组成一个新的KV对。</p>
<p>举例:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; val a = sc.parallelize(List((1,2),(3,4),(3,6)))</span><br><span class="line">scala&gt; a.reduceByKey((x,y) =&gt; x + y).collect</span><br><span class="line">res7: Array[(Int, Int)] = Array((1,2), (3,10))</span><br></pre></td></tr></table></figure>

<p>上述例子中，对Key相同的元素的值求和，因此Key为3的两个元素被转为了(3,10)。</p>
<p>转自：<a target="_blank" rel="noopener" href="https://www.zybuluo.com/jewes/note/35032">https://www.zybuluo.com/jewes/note/35032</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/bigdata/spark/sparkdiary/rddapi/" data-id="clhlnylgy00lrojup013e0ec9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spark/" rel="tag">spark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/bigdata/hadoop/cdh/cmarch" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/bigdata/hadoop/cdh/cmarch/" class="article-date">
  <time datetime="2017-06-12T09:24:02.000Z" itemprop="datePublished">2017-06-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/bigdata/hadoop/cdh/cmarch/">解析Cloudera Manager内部结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>CM的安装目录在什么位置？</li>
<li>hadoop配置文件在什么位置？</li>
<li>Cloudera manager运行所需要的信息存在什么位置？</li>
<li>CM结构和功能是什么？</li>
</ol>
<h2 id="1-相关目录"><a href="#1-相关目录" class="headerlink" title="1. 相关目录"></a>1. 相关目录</h2><ul>
<li>&#x2F;var&#x2F;log&#x2F;cloudera-scm-installer : 安装日志目录。</li>
<li>&#x2F;var&#x2F;log&#x2F;* : 相关日志文件（相关服务的及CM的）。</li>
<li>&#x2F;usr&#x2F;share&#x2F;cmf&#x2F; : 程序安装目录。</li>
<li>&#x2F;usr&#x2F;lib64&#x2F;cmf&#x2F; : Agent程序代码。</li>
<li>&#x2F;var&#x2F;lib&#x2F;cloudera-scm-server-db&#x2F;data : 内嵌数据库目录。</li>
<li>&#x2F;usr&#x2F;bin&#x2F;postgres : 内嵌数据库程序。</li>
<li>&#x2F;etc&#x2F;cloudera-scm-agent&#x2F; : agent的配置目录。</li>
<li>&#x2F;etc&#x2F;cloudera-scm-server&#x2F; : server的配置目录。</li>
<li>&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F; : Hadoop相关服务安装目录。</li>
<li>&#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F; : 下载的服务软件包数据，数据格式为parcels。</li>
<li>&#x2F;opt&#x2F;cloudera&#x2F;parcel-cache&#x2F; : 下载的服务软件包缓存数据。</li>
<li>&#x2F;etc&#x2F;hadoop&#x2F;* : 客户端配置文件目录。</li>
</ul>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><p><strong>Hadoop配置文件</strong></p>
<p>配置文件放置于&#x2F;var&#x2F;run&#x2F;cloudera-scm-agent&#x2F;process&#x2F;目录下。如：&#x2F;var&#x2F;run&#x2F;cloudera-scm-agent&#x2F;process&#x2F;193-hdfs-NAMENODE&#x2F;core-site.xml。这些配置文件是通过Cloudera Manager启动相应服务（如HDFS）时生成的，内容从数据库中获得（即通过界面配置的参数）。</p>
<p>在CM界面上更改配置是不会立即反映到配置文件中，这些信息会存储于数据库中，等下次重启服务时才会生成配置文件。且每次启动时都会产生新的配置文件。</p>
<p>CM Server主要数据库为scm基中放置配置的数据表为configs。里面包含了服务的配置信息，每一次配置的更改会把当前页面的所有配置内容添加到数据库中，以此保存配置修改历史。</p>
<p>scm数据库被配置成只能从localhost访问，如果需要从外部连接此数据库，修改<code>vim /var/lib/cloudera-scm-server-db/data/pg_hba.conf</code>文件,之后重启数据库。运行数据库的用户为cloudera-scm。</p>
<p><strong>查看配置内容</strong></p>
<p>直接查询scm数据库的configs数据表的内容。<br>访问REST API： <a target="_blank" rel="noopener" href="http://hostname:7180/api/v4/cm/deployment%EF%BC%8C%E8%BF%94%E5%9B%9EJSON%E6%A0%BC%E5%BC%8F%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E3%80%82">http://hostname:7180/api/v4/cm/deployment，返回JSON格式部署配置信息。</a></p>
<p><strong>配置生成方式</strong></p>
<p>CM为每个服务进程生成独立的配置目录（文件）。所有配置统一在服务端查询数据库生成（因为scm数据库只能在localhost下访问）生成配置文件，再由agent通过网络下载包含配置文件的zip包到本地解压到指定的目录。</p>
<p><strong>配置修改</strong></p>
<p>CM对于需要修改的配置预先定义，对于没有预先定义的配置,则通过在高级配置项中使用xml配置片段的方式进行配置。而对于&#x2F;etc&#x2F;hadoop&#x2F;下的配置文件是客户端的配置，可以在CM通过部署客户端生成客户端配置。</p>
<h2 id="3-数据库"><a href="#3-数据库" class="headerlink" title="3. 数据库"></a>3. 数据库</h2><p>Cloudera manager主要的数据库为scm,存储Cloudera manager运行所需要的信息：配置，主机，用户等。</p>
<h2 id="4-CM结构"><a href="#4-CM结构" class="headerlink" title="4. CM结构"></a>4. CM结构</h2><p>CM分为Server与Agent两部分及数据库（自带更改过的嵌入Postgresql）。它主要做三件事件：</p>
<ul>
<li>管理监控集群主机。</li>
<li>统一管理配置。</li>
<li>管理维护Hadoop平台系统。</li>
</ul>
<p>实现采用C&#x2F;S结构，Agent为客户端负责执行服务端发来的命令，执行方式一般为使用python调用相应的服务shell脚本。Server端为Java REST服务，提供REST API，Web管理端通过REST API调用Server端功能，Web界面使用富客户端技术（Knockout）。</p>
<ul>
<li>Server端主体使用Java实现。</li>
<li>Agent端主体使用Python, 服务的启动通过调用相应的shell脚本进行启动，如果启动失败会重复4次调用启动脚本。</li>
<li>Agent与Server保持心跳，使用Thrift RPC框架。</li>
</ul>
<h2 id="5-升级"><a href="#5-升级" class="headerlink" title="5. 升级"></a>5. 升级</h2><p>在CM中可以通过界面向导升级相关服务。升级过程为三步：</p>
<ul>
<li>下载服务软件包。</li>
<li>把所下载的服务软件包分发到集群中受管的机器上。</li>
<li>安装服务软件包，使用软链接的方式把服务程序目录链接到新安装的软件包目录上。</li>
</ul>
<h2 id="6-卸载"><a href="#6-卸载" class="headerlink" title="6. 卸载"></a>6. 卸载</h2><p><code>sudo /usr/share/cmf/uninstall-scm-express.sh</code>, 然后删除&#x2F;var&#x2F;lib&#x2F;cloudera-scm-server-db&#x2F;目录，不然下次安装可能不成功。</p>
<h2 id="7-开启postgresql远程访问"><a href="#7-开启postgresql远程访问" class="headerlink" title="7. 开启postgresql远程访问"></a>7. 开启postgresql远程访问</h2><p>CM内嵌数据库被配置成只能从localhost访问，如果需要从外部查看数据，数据修改<code>vim /var/lib/cloudera-scm-server-db/data/pg_hba.conf</code>文件,之后重启数据库。运行数据库的用户为cloudera-scm。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/bigdata/hadoop/cdh/cmarch/" data-id="clhlnylgu00l4ojupcslm4ggx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/bigdata/hadoop/cdh/cdh5install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/bigdata/hadoop/cdh/cdh5install/" class="article-date">
  <time datetime="2017-06-12T08:18:03.000Z" itemprop="datePublished">2017-06-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/bigdata/hadoop/cdh/cdh5install/">(转)离线安装Cloudera Manager 5和CDH5</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="关于CDH和Cloudera-Manager"><a href="#关于CDH和Cloudera-Manager" class="headerlink" title="关于CDH和Cloudera Manager"></a>关于CDH和Cloudera Manager</h2><p>CDH (Cloudera’s Distribution, including Apache Hadoop)，是Hadoop众多分支中的一种，由Cloudera维护，基于稳定版本的Apache Hadoop构建，并集成了很多补丁，可直接用于生产环境。</p>
<p>Cloudera Manager则是为了便于在集群中进行Hadoop等大数据处理相关的服务安装和监控管理的组件，对集群中主机、Hadoop、Hive、Spark等服务的安装配置管理做了极大简化。</p>
<h2 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h2><ul>
<li>实验环境：Mac下VMware虚拟机</li>
<li>操作系统：CentOS 6.5 x64 (至少内存2G以上，这里内存不够的同学建议还是整几台真机配置比较好，将CDH的所有组件全部安装会占用很多内存，我已开始设置的虚拟机内存是1G，安装过程中直接卡死了)</li>
<li>Cloudera Manager：5.1.3</li>
<li>CDH: 5.1.3</li>
</ul>
<h2 id="安装说明"><a href="#安装说明" class="headerlink" title="安装说明"></a>安装说明</h2><p>官方参考文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Installation-Guide/cm5ig_install_path_C.html">http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Installation-Guide/cm5ig_install_path_C.html</a></p>
<p>官方共给出了3中安装方式：</p>
<p>第一种方法必须要求所有机器都能连网，由于最近各种国外的网站被墙的厉害，我尝试了几次各种超时错误，巨耽误时间不说，一旦失败，重装非常痛苦。</p>
<p>第二种方法下载很多包。</p>
<p>第三种方法对系统侵入性最小,最大优点可实现全离线安装，而且重装什么的都非常方便。后期的集群统一包升级也非常好。这也是我之所以选择离线安装的原因。</p>
<h2 id="相关包的下载地址"><a href="#相关包的下载地址" class="headerlink" title="相关包的下载地址"></a>相关包的下载地址</h2><p>Cloudera Manager下载地址：<br><a target="_blank" rel="noopener" href="http://archive.cloudera.com/cm5/cm/5/cloudera-manager-el6-cm5.1.3_x86_64.tar.gz%EF%BC%8C">http://archive.cloudera.com/cm5/cm/5/cloudera-manager-el6-cm5.1.3_x86_64.tar.gz，</a><br>下载信息：<br><a target="_blank" rel="noopener" href="http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Version-and-Download-Information/Cloudera-Manager-Version-and-Download-Information.html#cmvd_topic_1">http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Version-and-Download-Information/Cloudera-Manager-Version-and-Download-Information.html#cmvd_topic_1</a></p>
<p>CDH安装包地址：<a target="_blank" rel="noopener" href="http://archive.cloudera.com/cdh5/parcels/latest/%EF%BC%8C%E7%94%B1%E4%BA%8E%E6%88%91%E4%BB%AC%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%BACentOS6.5%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E4%BB%A5%E4%B8%8B%E6%96%87%E4%BB%B6%EF%BC%9A">http://archive.cloudera.com/cdh5/parcels/latest/，由于我们的操作系统为CentOS6.5，需要下载以下文件：</a></p>
<ul>
<li>CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel</li>
<li>CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel.sha1</li>
<li>manifest.json</li>
</ul>
<p>注意：与CDH4的不同，原来安装CDH4的时候还需要下载IMPALA、Cloudera Search(SOLR)，CDH5中将他们包含在一起了，所以只需要下载一个CDH5的包就可以了。</p>
<h2 id="准备工作：系统环境搭建"><a href="#准备工作：系统环境搭建" class="headerlink" title="准备工作：系统环境搭建"></a>准备工作：系统环境搭建</h2><p>以下操作均用root用户操作。</p>
<h3 id="1-网络配置-所有节点"><a href="#1-网络配置-所有节点" class="headerlink" title="1. 网络配置(所有节点)"></a>1. 网络配置(所有节点)</h3><p><code>vi /etc/sysconfig/network</code>修改hostname：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NETWORKING=yes</span><br><span class="line">HOSTNAME=n1</span><br></pre></td></tr></table></figure>
<p>通过<code>service network restart</code>重启网络服务生效。</p>
<p><code>vi /etc/hosts</code>,修改ip与主机名的对应关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.106   n1</span><br><span class="line">192.168.1.107   n2</span><br><span class="line">192.168.1.108   n3</span><br></pre></td></tr></table></figure>

<p>注意：这里需要将每台机器的ip及主机名对应关系都写进去，本机的也要写进去，否则启动Agent的时候会提示hostname解析错误。</p>
<h3 id="2-打通SSH，设置ssh无密码登陆（所有节点）"><a href="#2-打通SSH，设置ssh无密码登陆（所有节点）" class="headerlink" title="2.打通SSH，设置ssh无密码登陆（所有节点）"></a>2.打通SSH，设置ssh无密码登陆（所有节点）</h3><p>在主节点上执行<code>ssh-keygen -t rsa</code>一路回车，生成无密码的密钥对。</p>
<p>将公钥添加到认证文件中：<code>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code>，并设置authorized_keys的访问权限：<code>chmod 600 ~/.ssh/authorized_keys</code>。</p>
<p>scp文件到所有datenode节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/authorized_keys root@n2:~/.ssh/</span><br></pre></td></tr></table></figure>

<p>测试：在主节点上ssh n2，正常情况下，不需要密码就能直接登陆进去了。</p>
<h3 id="3-安装Oracle的Java（所有节点）"><a href="#3-安装Oracle的Java（所有节点）" class="headerlink" title="3.安装Oracle的Java（所有节点）"></a>3.安装Oracle的Java（所有节点）</h3><p>CentOS，自带OpenJdk，不过运行CDH5需要使用Oracle的Jdk，需要Java 7的支持。</p>
<p>卸载自带的OpenJdk，使用<code>rpm -qa | grep java</code>查询java相关的包，使用<code>rpm -e --nodeps 包名</code>卸载之。</p>
<p>去Oracle的官网下载jdk的rpm安装包，并使用<code>rpm -ivh 包名</code>安装之。</p>
<p>由于是rpm包并不需要我们来配置环境变量，我们只需要配置一个全局的JAVA_HOME变量即可，执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;JAVA_HOME=/usr/java/latest/&quot; &gt;&gt; /etc/environment</span><br></pre></td></tr></table></figure>

<h3 id="4-安装配置MySql（主节点）"><a href="#4-安装配置MySql（主节点）" class="headerlink" title="4.安装配置MySql（主节点）"></a>4.安装配置MySql（主节点）</h3><p>通过<code>yum install mysql-server</code>安装mysql服务器。<code>chkconfig mysqld on</code>设置开机启动，并<code>service mysqld start</code>启动mysql服务，并根据提示设置root的初试密码：<code>mysqladmin -u root password &#39;xxxx&#39;</code>。</p>
<p><code>mysql -uroot -pxxxx</code>进入mysql命令行，创建以下数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#hive</span><br><span class="line">create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br><span class="line">#activity monitor</span><br><span class="line">create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span><br></pre></td></tr></table></figure>

<p>设置root授权访问以上所有的数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#授权root用户在主节点拥有所有数据库的访问权限</span><br><span class="line">grant all privileges on *.* to &#x27;root&#x27;@&#x27;n1&#x27; identified by &#x27;xxxx&#x27; with grant option;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>官方MySql配置文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Installation-Guide/cm5ig_mysql.html#cmig_topic_5_5">http://www.cloudera.com/content/cloudera/en/documentation/cloudera-manager/v5-latest/Cloudera-Manager-Installation-Guide/cm5ig_mysql.html#cmig_topic_5_5</a></p>
<h3 id="5-关闭防火墙和SELinux"><a href="#5-关闭防火墙和SELinux" class="headerlink" title="5. 关闭防火墙和SELinux"></a>5. 关闭防火墙和SELinux</h3><p>注意： 需要在所有的节点上执行，因为涉及到的端口太多了，临时关闭防火墙是为了安装起来更方便，安装完毕后可以根据需要设置防火墙策略，保证集群安全。</p>
<p>关闭防火墙：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop （临时关闭）</span><br><span class="line">chkconfig iptables off （重启后生效）</span><br></pre></td></tr></table></figure>

<p>关闭SELINUX（实际安装过程中发现没有关闭也是可以的，不知道会不会有问题，还需进一步进行验证）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 （临时生效）</span><br><span class="line">修改 /etc/selinux/config 下的 SELINUX=disabled （重启后永久生效）</span><br></pre></td></tr></table></figure>

<h3 id="6-所有节点配置NTP服务"><a href="#6-所有节点配置NTP服务" class="headerlink" title="6. 所有节点配置NTP服务"></a>6. 所有节点配置NTP服务</h3><p>集群中所有主机必须保持时间同步，如果时间相差较大会引起各种问题。 具体思路如下：</p>
<p>master节点作为ntp服务器与外界对时中心同步时间，随后对所有datanode节点提供时间同步服务。</p>
<p>所有datanode节点以master节点为基础同步时间。</p>
<p>所有节点安装相关组件：<code>yum install ntp</code>。完成后，配置开机启动：<code>chkconfig ntpd on</code>,检查是否设置成功：<code>chkconfig --list ntpd</code>其中2-5为on状态就代表成功。</p>
<p>主节点配置</p>
<p>在配置之前，先使用ntpdate手动同步一下时间，免得本机与对时中心时间差距太大，使得ntpd不能正常同步。这里选用65.55.56.206作为对时中心,<code>ntpdate -u 65.55.56.206</code>。</p>
<p>ntp服务只有一个配置文件，配置好了就OK。 这里只给出有用的配置，不需要的配置都用#注掉，这里就不在给出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict -6 ::1</span><br><span class="line">restrict default nomodify notrap </span><br><span class="line">server 65.55.56.206 prefer</span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line">keys /etc/ntp/keys</span><br></pre></td></tr></table></figure>

<p>配置文件完成，保存退出，启动服务，执行如下命令：<code>service ntpd start</code></p>
<p>检查是否成功，用ntpstat命令查看同步状态，出现以下状态代表启动成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">synchronised to NTP server () at stratum 2</span><br><span class="line">time correct to within 74 ms</span><br><span class="line">polling server every 128 s</span><br></pre></td></tr></table></figure>

<p>如果出现异常请等待几分钟，一般等待5-10分钟才能同步。</p>
<p>配置ntp客户端（所有datanode节点）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">driftfile /var/lib/ntp/drift</span><br><span class="line">restrict 127.0.0.1</span><br><span class="line">restrict -6 ::1</span><br><span class="line">restrict default kod nomodify notrap nopeer noquery</span><br><span class="line">restrict -6 default kod nomodify notrap nopeer noquery</span><br><span class="line">#这里是主节点的主机名或者ip</span><br><span class="line">server n1</span><br><span class="line">includefile /etc/ntp/crypto/pw</span><br><span class="line">keys /etc/ntp/keys</span><br></pre></td></tr></table></figure>

<p>ok保存退出，请求服务器前，请先使用ntpdate手动同步一下时间：<code>ntpdate -u n1</code> (主节点ntp服务器)</p>
<p>这里可能出现同步失败的情况，请不要着急，一般是本地的ntp服务器还没有正常启动，一般需要等待5-10分钟才可以正常同步。启动服务：<code>service ntpd start</code></p>
<p>因为是连接内网，这次启动等待的时间会比master节点快一些，但是也需要耐心等待一会儿。</p>
<h2 id="正式开工"><a href="#正式开工" class="headerlink" title="正式开工"></a>正式开工</h2><p>安装Cloudera Manager Server 和Agent</p>
<p><strong>主节点解压安装</strong></p>
<p>cloudera manager的目录默认位置在&#x2F;opt下，解压：<code>tar xzvf cloudera-manager*.tar.gz</code>将解压后的cm-5.1.3和cloudera目录放到&#x2F;opt目录下。</p>
<p><strong>为Cloudera Manager 5建立数据库</strong></p>
<p>首先需要去MySql的官网下载JDBC驱动，<a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/connector/j/%E3%80%82">http://dev.mysql.com/downloads/connector/j/。</a></p>
<p>解压后，找到mysql-connector-java-5.1.33-bin.jar，放到<code>/opt/cm-5.1.3/share/cmf/lib/</code>中。</p>
<p>在主节点初始化CM5的数据库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/cm-5.1.3/share/cmf/schema/scm_prepare_database.sh mysql cm -hlocalhost -uroot -pxxxx --scm-host localhost scm scm scm</span><br></pre></td></tr></table></figure>

<p><strong>Agent配置</strong></p>
<p>修改<code>/opt/cm-5.1.3/etc/cloudera-scm-agent/config.ini</code>中的server_host为主节点的主机名。</p>
<p><strong>同步Agent到其他节点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /opt/cm-5.1.3 root@n2:/opt/</span><br></pre></td></tr></table></figure>

<p><strong>在所有节点创建cloudera-scm用户</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd --system --home=/opt/cm-5.1.3/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment &quot;Cloudera SCM User&quot; cloudera-scm</span><br></pre></td></tr></table></figure>

<p><strong>准备Parcels，用以安装CDH5</strong></p>
<p>将CHD5相关的Parcel包放到主节点的<code>/opt/cloudera/parcel-repo/</code>目录中（parcel-repo需要手动创建）。</p>
<p>相关的文件如下：</p>
<ul>
<li>CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel</li>
<li>CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel.sha1</li>
<li>manifest.json</li>
</ul>
<p>最后将CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel.sha1，重命名为CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel.sha，这点必须注意，否则，系统会重新下载CDH-5.1.3-1.cdh5.1.3.p0.12-el6.parcel文件。</p>
<p><strong>相关启动脚本</strong></p>
<p>通过<code>/opt/cm-5.1.3/etc/init.d/cloudera-scm-server start</code>启动服务端。</p>
<p>通过<code>/opt/cm-5.1.3/etc/init.d/cloudera-scm-agent start</code>启动Agent服务。</p>
<p>我们启动的其实是个service脚本，需要停止服务将以上的start参数改为stop就可以了，重启是restart。</p>
<h2 id="CDH5的安装配置"><a href="#CDH5的安装配置" class="headerlink" title="CDH5的安装配置"></a>CDH5的安装配置</h2><p>Cloudera Manager Server和Agent都启动以后，就可以进行CDH5的安装配置了。</p>
<p>这时可以通过浏览器访问主节点的7180端口测试一下了（由于CM Server的启动需要花点时间，这里可能要等待一会才能访问），默认的用户名和密码均为admin。</p>
<p><img src="/images/hadoop/cdhinstall/1.png"></p>
<p>免费版本的CM5已经没有原来50个节点数量的限制了。</p>
<p><img src="/images/hadoop/cdhinstall/2.png"></p>
<p>各个Agent节点正常启动后，可以在当前管理的主机列表中看到对应的节点。选择要安装的节点，点继续。</p>
<p><img src="/images/hadoop/cdhinstall/3.png"></p>
<p>接下来，出现以下包名，说明本地Parcel包配置无误，直接点继续就可以了。</p>
<p><img src="/images/hadoop/cdhinstall/4.png"></p>
<p>点击，继续，如果配置本地Parcel包无误，那么下图中的已下载，应该是瞬间就完成了，然后就是耐心等待分配过程就行了，大约10多分钟吧，取决于内网网速。</p>
<p><img src="/images/hadoop/cdhinstall/5.png"></p>
<p>接下来是服务器检查，可能会遇到以下问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cloudera 建议将 /proc/sys/vm/swappiness 设置为 0。当前设置为 60。使用 sysctl 命令在运行时更改该设置并编辑 /etc/sysctl.conf 以在重启后保存该设置。您可以继续进行安装，但可能会遇到问题，Cloudera Manager 报告您的主机由于交换运行状况不佳。以下主机受到影响：</span><br></pre></td></tr></table></figure>
<p>通过<code>echo 0 &gt; /proc/sys/vm/swappiness</code>即可解决。</p>
<p><img src="/images/hadoop/cdhinstall/6.png"></p>
<p>接下来是选择安装服务：</p>
<p><img src="/images/hadoop/cdhinstall/7.png"></p>
<p>服务配置，一般情况下保持默认就可以了（Cloudera Manager会根据机器的配置自动进行配置，如果需要特殊调整，自行进行设置就可以了）：</p>
<p><img src="/images/hadoop/cdhinstall/8.png"></p>
<p>接下来是数据库的设置，检查通过后就可以进行下一步的操作了：</p>
<p><img src="/images/hadoop/cdhinstall/9.png"></p>
<p>下面是集群设置的审查页面，我这里都是保持默认配置的：</p>
<p><img src="/images/hadoop/cdhinstall/10.png"></p>
<p>终于到安装各个服务的地方了，注意，这里安装Hive的时候可能会报错，因为我们使用了MySql作为hive的元数据存储，hive默认没有带mysql的驱动，通过以下命令拷贝一个就行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/cm-5.1.3/share/cmf/lib/mysql-connector-java-5.1.33-bin.jar /opt/cloudera/parcels/CDH-5.1.3-1.cdh5.1.3.p0.12/lib/hive/lib/</span><br></pre></td></tr></table></figure>
<p><img src="/images/hadoop/cdhinstall/11.png"></p>
<p>服务的安装过程大约半小时内就可以完成：</p>
<p><img src="/images/hadoop/cdhinstall/12.png"></p>
<p>安装完成后，就可以进入集群界面看一下集群的当前状况了。</p>
<p>这里可能会出现无法发出查询：对 Service Monitor 的请求超时的错误提示，如果各个组件安装没有问题，一般是因为服务器比较卡导致的，过一会刷新一下页面就好了：</p>
<p><img src="/images/hadoop/cdhinstall/13.png"></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在集群的一台机器上执行以下模拟Pi的示例程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u hdfs hadoop jar /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce/hadoop-mapreduce-examples.jar pi 10 100</span><br></pre></td></tr></table></figure>

<p>执行过程需要花一定的时间，通过YARN的后台也可以看到MapReduce的执行状态：</p>
<p><img src="/images/hadoop/cdhinstall/14.png"></p>
<p>MapReduce执行过程中终端的输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Number of Maps  = 10</span><br><span class="line">Samples per Map = 100</span><br><span class="line">Wrote input for Map #0</span><br><span class="line">Wrote input for Map #1</span><br><span class="line">Wrote input for Map #2</span><br><span class="line">Wrote input for Map #3</span><br><span class="line">Wrote input for Map #4</span><br><span class="line">Wrote input for Map #5</span><br><span class="line">Wrote input for Map #6</span><br><span class="line">Wrote input for Map #7</span><br><span class="line">Wrote input for Map #8</span><br><span class="line">Wrote input for Map #9</span><br><span class="line">Starting Job</span><br><span class="line">14/10/13 01:15:34 INFO client.RMProxy: Connecting to ResourceManager at n1/192.168.1.161:8032</span><br><span class="line">14/10/13 01:15:36 INFO input.FileInputFormat: Total input paths to process : 10</span><br><span class="line">14/10/13 01:15:37 INFO mapreduce.JobSubmitter: number of splits:10</span><br><span class="line">14/10/13 01:15:39 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1413132307582_0001</span><br><span class="line">14/10/13 01:15:40 INFO impl.YarnClientImpl: Submitted application application_1413132307582_0001</span><br><span class="line">14/10/13 01:15:40 INFO mapreduce.Job: The url to track the job: http://n1:8088/proxy/application_1413132307582_0001/</span><br><span class="line">14/10/13 01:15:40 INFO mapreduce.Job: Running job: job_1413132307582_0001</span><br><span class="line">14/10/13 01:17:13 INFO mapreduce.Job: Job job_1413132307582_0001 running in uber mode : false</span><br><span class="line">14/10/13 01:17:13 INFO mapreduce.Job:  map 0% reduce 0%</span><br><span class="line">14/10/13 01:18:02 INFO mapreduce.Job:  map 10% reduce 0%</span><br><span class="line">14/10/13 01:18:25 INFO mapreduce.Job:  map 20% reduce 0%</span><br><span class="line">14/10/13 01:18:35 INFO mapreduce.Job:  map 30% reduce 0%</span><br><span class="line">14/10/13 01:18:45 INFO mapreduce.Job:  map 40% reduce 0%</span><br><span class="line">14/10/13 01:18:53 INFO mapreduce.Job:  map 50% reduce 0%</span><br><span class="line">14/10/13 01:19:01 INFO mapreduce.Job:  map 60% reduce 0%</span><br><span class="line">14/10/13 01:19:09 INFO mapreduce.Job:  map 70% reduce 0%</span><br><span class="line">14/10/13 01:19:17 INFO mapreduce.Job:  map 80% reduce 0%</span><br><span class="line">14/10/13 01:19:25 INFO mapreduce.Job:  map 90% reduce 0%</span><br><span class="line">14/10/13 01:19:33 INFO mapreduce.Job:  map 100% reduce 0%</span><br><span class="line">14/10/13 01:19:51 INFO mapreduce.Job:  map 100% reduce 100%</span><br><span class="line">14/10/13 01:19:53 INFO mapreduce.Job: Job job_1413132307582_0001 completed successfully</span><br><span class="line">14/10/13 01:19:56 INFO mapreduce.Job: Counters: 49</span><br><span class="line">    File System Counters</span><br><span class="line">        FILE: Number of bytes read=91</span><br><span class="line">        FILE: Number of bytes written=1027765</span><br><span class="line">        FILE: Number of read operations=0</span><br><span class="line">        FILE: Number of large read operations=0</span><br><span class="line">        FILE: Number of write operations=0</span><br><span class="line">        HDFS: Number of bytes read=2560</span><br><span class="line">        HDFS: Number of bytes written=215</span><br><span class="line">        HDFS: Number of read operations=43</span><br><span class="line">        HDFS: Number of large read operations=0</span><br><span class="line">        HDFS: Number of write operations=3</span><br><span class="line">    Job Counters</span><br><span class="line">        Launched map tasks=10</span><br><span class="line">        Launched reduce tasks=1</span><br><span class="line">        Data-local map tasks=10</span><br><span class="line">        Total time spent by all maps in occupied slots (ms)=118215</span><br><span class="line">        Total time spent by all reduces in occupied slots (ms)=11894</span><br><span class="line">        Total time spent by all map tasks (ms)=118215</span><br><span class="line">        Total time spent by all reduce tasks (ms)=11894</span><br><span class="line">        Total vcore-seconds taken by all map tasks=118215</span><br><span class="line">        Total vcore-seconds taken by all reduce tasks=11894</span><br><span class="line">        Total megabyte-seconds taken by all map tasks=121052160</span><br><span class="line">        Total megabyte-seconds taken by all reduce tasks=12179456</span><br><span class="line">    Map-Reduce Framework</span><br><span class="line">        Map input records=10</span><br><span class="line">        Map output records=20</span><br><span class="line">        Map output bytes=180</span><br><span class="line">        Map output materialized bytes=340</span><br><span class="line">        Input split bytes=1380</span><br><span class="line">        Combine input records=0</span><br><span class="line">        Combine output records=0</span><br><span class="line">        Reduce input groups=2</span><br><span class="line">        Reduce shuffle bytes=340</span><br><span class="line">        Reduce input records=20</span><br><span class="line">        Reduce output records=0</span><br><span class="line">        Spilled Records=40</span><br><span class="line">        Shuffled Maps =10</span><br><span class="line">        Failed Shuffles=0</span><br><span class="line">        Merged Map outputs=10</span><br><span class="line">        GC time elapsed (ms)=1269</span><br><span class="line">        CPU time spent (ms)=9530</span><br><span class="line">        Physical memory (bytes) snapshot=3792773120</span><br><span class="line">        Virtual memory (bytes) snapshot=16157274112</span><br><span class="line">        Total committed heap usage (bytes)=2856624128</span><br><span class="line">    Shuffle Errors</span><br><span class="line">        BAD_ID=0</span><br><span class="line">        CONNECTION=0</span><br><span class="line">        IO_ERROR=0</span><br><span class="line">        WRONG_LENGTH=0</span><br><span class="line">        WRONG_MAP=0</span><br><span class="line">        WRONG_REDUCE=0</span><br><span class="line">    File Input Format Counters</span><br><span class="line">        Bytes Read=1180</span><br><span class="line">    File Output Format Counters</span><br><span class="line">        Bytes Written=97</span><br><span class="line">Job Finished in 262.659 seconds</span><br><span class="line">Estimated value of Pi is 3.14800000000000000000</span><br></pre></td></tr></table></figure>

<p>检查Hue</p>
<p>首次登陆Hue会让设置一个初试的用户名和密码，设置好，登陆到后台，会做一次检查，一切正常后会提示：</p>
<p><img src="/images/hadoop/cdhinstall/15.png"></p>
<p>到这里表明我们的集群可以使用了。</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>Agent启动后，安装阶段“当前管理的主机”中显示的节点不全，每次刷新显示的都不一样。</p>
<p>Agent的错误日志表现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[18/Nov/2014 21:12:56 +0000] 22681 MainThread agent ERROR Heartbeating to master:7182 failed.</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/src/cmf/agent.py&quot;, line 820, in send_heartbeat</span><br><span class="line">    response = self.requestor.request(&#x27;heartbeat&#x27;, dict(request=heartbeat))</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/ipc.py&quot;, line 139, in request</span><br><span class="line">    return self.issue_request(call_request, message_name, request_datum)</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/ipc.py&quot;, line 255, in issue_request</span><br><span class="line">    return self.read_call_response(message_name, buffer_decoder)</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/ipc.py&quot;, line 235, in read_call_response</span><br><span class="line">    raise self.read_error(writers_schema, readers_schema, decoder)</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/ipc.py&quot;, line 244, in read_error</span><br><span class="line">    return AvroRemoteException(datum_reader.read(decoder))</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/io.py&quot;, line 444, in read</span><br><span class="line">    return self.read_data(self.writers_schema, self.readers_schema, decoder)</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/io.py&quot;, line 448, in read_data</span><br><span class="line">    if not DatumReader.match_schemas(writers_schema, readers_schema):</span><br><span class="line">  File &quot;/home/opt/cm-5.2.0/lib64/cmf/agent/build/env/lib/python2.6/site-packages/avro-1.6.3-py2.6.egg/avro/io.py&quot;, line 379, in match_schemas</span><br><span class="line">    w_type = writers_schema.type</span><br><span class="line">AttributeError: &#x27;NoneType&#x27; object has no attribute &#x27;type&#x27;</span><br></pre></td></tr></table></figure>

<p>这是由于在主节点上启动了Agent后，又将Agent scp到了其他节点上导致的，首次启动Agent，它会生成一个uuid，路径为：<code>/opt/cm-5.1.3/lib/cloudera-scm-agent/uuid</code>,这样的话每台机器上的Agent的uuid都是一样的了，就会出现紊乱的情况。</p>
<p><strong>解决方案：</strong></p>
<p>删除<code>/opt/cm-5.1.3/lib/cloudera-scm-agent/</code>目录下的所有文件。</p>
<p>清空主节点CM数据库。</p>
<p><strong>最佳实践</strong></p>
<p>在内网单独搭建yum的repo，然后CM的管理界面安装Agent，这样安装比较快，也不会出现什么问题。</p>
<p>如果手动添加添加Agent的话，需要注意启动之前删除相关的标示文件，否则Server端在数据库中记录Agent的信息，还得清理数据库中的信息，就麻烦了。</p>
<p>转自：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/jasondan/p/4011153.html">http://www.cnblogs.com/jasondan/p/4011153.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/bigdata/hadoop/cdh/cdh5install/" data-id="clhlnylgu00l1ojupgqry9gfw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/plang/java/base/exception" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/plang/java/base/exception/" class="article-date">
  <time datetime="2017-05-05T06:22:06.000Z" itemprop="datePublished">2017-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/">JAVA</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/BASE/">BASE</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/plang/java/base/exception/">java 中的Exception RuntimeException 区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>JAVA项目中直接抛出Exception或RuntimeException为严重质量问题。如要自己抛出异常就需要自定义异常，这是好的编程习惯。</p>
<p>自定义异常通常会继承Exception或RuntimeException，这两个有点小区别：</p>
<p>抛出Exception，外部代码必须要显示处理，try-catch或再次抛出，否则编译会报错，一般IDE也会提示错误。</p>
<p>抛出RuntimeException,外部代码不用显示处理，编译可以通过，在运行时如没有被try-catch处理，JVM会处理这种异常。</p>
<pre><code>public class RuntimeException &#123;
    public static void main(String[] args) &#123;
        String str=&quot;123&quot;;
        int temp=Integer.parseInt(str);
        System.out.println(temp*temp);
    &#125;
&#125;
</code></pre>
<p>parseInt方法的源代码如下：</p>
<pre><code>public static int parseInt(String s) throws NumberFormatException &#123;
    return parseInt(s,10);
&#125;
</code></pre>
<p>NumberFormatException是RuntimeException的子类，所以外部不处理这种异常是可以的。</p>
<p>一般项目中，异常是都要被处理了，所以一般我们自己实现的异常要继承Exception，强制要求调用者处理抛出的异常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/plang/java/base/exception/" data-id="clhlnylho00p9ojup94xb3y9b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/plang/lisp/pcldiary/chapter11" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/plang/lisp/pcldiary/chapter11/" class="article-date">
  <time datetime="2017-04-08T14:03:02.000Z" itemprop="datePublished">2017-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/">Lisp</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/Common-Lisp/">Common Lisp</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/plang/lisp/pcldiary/chapter11/">第11章 集合-实用Common Lisp编程笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><pre><code>CL-USER&gt; (vector)
#()
CL-USER&gt; (vector 1)
#(1)
CL-USER&gt; (vector 1 2)
#(1 2)
CL-USER&gt; #(1 2)
#(1 2)
</code></pre>
<p><code>#(...)</code>是Lisp打印器和读取器使用向量的字面形式，可以用print和read打印和恢复重向量。</p>
<p>可以用<code>#(...)</code>添加向量，但更建议用vector创建要修改的向量。</p>
<h3 id="make-array"><a href="#make-array" class="headerlink" title="make-array"></a>make-array</h3><p>make-array可以创建任何维度的数组及定长和变长向量。</p>
<pre><code>CL-USER&gt; (make-array 5 :initial-element nil)
#(NIL NIL NIL NIL NIL)
</code></pre>
<p>创建可填充的向量</p>
<pre><code>CL-USER&gt; (defparameter *x* (make-array 5 :fill-pointer 0))
*X*
CL-USER&gt; (vector-push &#39;a *x*)
0
CL-USER&gt; *x*
#(A)
CL-USER&gt; (vector-push &#39;b *x*)
1
CL-USER&gt; (vector-push &#39;c *x*)
2
CL-USER&gt; (vector-push &#39;d *x*)
3
CL-USER&gt; (vector-push &#39;e *x*)
4
CL-USER&gt; (vector-push &#39;f *x*)
NIL
CL-USER&gt; *x*
#(A B C D E)
CL-USER&gt; (vector-pop *x*)
E
CL-USER&gt; (vector-pop *x*)
D
CL-USER&gt; (vector-pop *x*)
C
CL-USER&gt; *x*
#(A B)
CL-USER&gt; 
</code></pre>
<p>创建可变长的向量</p>
<pre><code>(make-array 5 :fill-pointer 0 :adjustable t)
</code></pre>
<h2 id="向量的子类型"><a href="#向量的子类型" class="headerlink" title="向量的子类型"></a>向量的子类型</h2><p>字符串<code>“foo&quot;</code>和<code>#()</code>写成的字面向量一样，大小固定不可修改。</p>
<p>创建变长字符串：</p>
<pre><code>CL-USER&gt; (make-array 5 :fill-pointer 0 :adjustable t :element-type &#39;character)
&quot;&quot;
</code></pre>
<p>创建位向量：</p>
<pre><code>CL-USER&gt; (make-array 5 :fill-pointer 0 :adjustable t :element-type &#39;bit)
#*
</code></pre>
<h2 id="序列操作"><a href="#序列操作" class="headerlink" title="序列操作"></a>序列操作</h2><pre><code>CL-USER&gt; (defparameter *x* (vector 1 2 3))
*X*
CL-USER&gt; (length *x*)
3
CL-USER&gt; (elt *x* 0)
1
CL-USER&gt; (elt *x* 1)
2
CL-USER&gt; (elt *x* 2)
3
CL-USER&gt; (elt *x* 3)
Invoking restart: Kill this thread
; Evaluation aborted on #&lt;CCL::SEQUENCE-INDEX-TYPE-ERROR #x21008241DD&gt;.
CL-USER&gt; (setf (elt *x* 0) 10)
10
CL-USER&gt; *x*
#(10 2 3)
CL-USER&gt; 
</code></pre>
<h2 id="序列迭代函数"><a href="#序列迭代函数" class="headerlink" title="序列迭代函数"></a>序列迭代函数</h2><p>理论上所有的序列操作都可以归纳于length、elt、setf操作。</p>
<p>序列函数允许不用显示遍历列表就可以表达一定的序列操作。</p>
<pre><code>CL-USER&gt; (count 1 #(1 2 3 4 1 2 3))
2
CL-USER&gt; (remove 1 #(1 2 3 4 1 2 3))
#(2 3 4 2 3)
CL-USER&gt; (remove 1 &#39;(1 2 3 4 1 2 3))
(2 3 4 2 3)
CL-USER&gt; (remove #\a &quot;ababcdeft&quot;)
&quot;bbcdeft&quot;
CL-USER&gt; (substitute 10 1 #(1 2 1 2))
#(10 2 10 2)
CL-USER&gt; (substitute 10 1 &#39;(1 2 1 2))
(10 2 10 2)
CL-USER&gt; (substitute #\b #\a &quot;abcabc&quot;)
&quot;bbcbbc&quot;
CL-USER&gt; (find 3 #(1 2 3 4))
3
CL-USER&gt; (find 5 #(1 2 3 4))
NIL
CL-USER&gt; (position 2 #(1 1 1 2 3 ))
3
CL-USER&gt; 
</code></pre>
<p>关键字参数：</p>
<p>:test 两参数函数用于比较元素和项</p>
<p>:key 单参数函数用于从实际序列元素中解出用于比较的关键字</p>
<p>:start 子序列的起始索引</p>
<p>:end 子序列的结束索引</p>
<p>:from-end 如果为真以相反顺序遍历</p>
<p>:count 需要移除或替换的元素个数</p>
<pre><code>CL-USER&gt; (defparameter *v* #((a 10) (b 20) (a 30) (b 40)))
*V*
CL-USER&gt; (defun verbose-first (x) (format t &quot;looking at ~s~%&quot; x) (first x))
VERBOSE-FIRST
CL-USER&gt; (count &#39;a *v* :key #&#39;verbose-first)
looking at (A 10)
looking at (B 20)
looking at (A 30)
looking at (B 40)
2
CL-USER&gt; (count &#39;a *v* :key #&#39;verbose-first :from-end t)
looking at (B 40)
looking at (A 30)
looking at (B 20)
looking at (A 10)
2
CL-USER&gt; 
</code></pre>
<h2 id="高阶函数变体"><a href="#高阶函数变体" class="headerlink" title="高阶函数变体"></a>高阶函数变体</h2><p>对于每个序列迭代函数都有两种高阶函数变体，它们接受一个将在每个序列元素上调用的函数，以此来代替项参数。</p>
<p>第一类追加-IF，第二类追加-IF-NOT。</p>
<pre><code>CL-USER&gt; (count-if #&#39;evenp #((1 a) (2 b) (3 c) (4 d) (5 e)) :key #&#39;first)
2
CL-USER&gt; (count-if-not #&#39;evenp #((1 a) (2 b) (3 c) (4 d) (5 e)) :key #&#39;first)
3
CL-USER&gt; (remove-if-not #&#39;alpha-char-p #(&quot;foo&quot; &quot;bar&quot; &quot;1baz&quot;) :key #&#39;(lambda (x) (elt x 0)))
#(&quot;foo&quot; &quot;bar&quot;)
CL-USER&gt; (remove-duplicates #(1 2 1 2 3 1 2 3 4))
#(1 2 3 4)
CL-USER&gt; 
</code></pre>
<h2 id="排序与合并"><a href="#排序与合并" class="headerlink" title="排序与合并"></a>排序与合并</h2><pre><code>CL-USER&gt; (sort #(&quot;foo&quot; &quot;bar&quot; &quot;baz&quot;) #&#39;string&lt;)
\#(&quot;bar&quot; &quot;baz&quot; &quot;foo&quot;)
CL-USER&gt; (merge &#39;vector #(1 3 5) #(2 3 4) #&#39;&lt;)
\#(1 2 3 3 4 5)
CL-USER&gt;
</code></pre>
<h2 id="子序列操作"><a href="#子序列操作" class="headerlink" title="子序列操作"></a>子序列操作</h2><p>subseq取子序列，支持setf。</p>
<pre><code>CL-USER&gt; (subseq &quot;foobarbaz&quot; 3)
&quot;barbaz&quot;
CL-USER&gt; (subseq &quot;foobarbaz&quot; 3 6)
&quot;bar&quot;
CL-USER&gt; (defparameter *x* (copy-seq &quot;foobarbaz&quot;))
*X*
CL-USER&gt; (setf (subseq *x* 3 6) &quot;xxx&quot;)
&quot;xxx&quot;
CL-USER&gt; *x*
&quot;fooxxxbaz&quot;
CL-USER&gt; (setf (subseq *x* 3 6) &quot;abcd&quot;)
&quot;abcd&quot;
CL-USER&gt; *x*
&quot;fooabcbaz&quot;
CL-USER&gt; (setf (subseq *x* 3 6) &quot;xx&quot;)
&quot;xx&quot;
CL-USER&gt; *x*
&quot;fooxxcbaz&quot;
CL-USER&gt; 
</code></pre>
<p>匹配串：</p>
<pre><code>CL-USER&gt; (position #\b &quot;foobarbaz&quot;)
3
CL-USER&gt; (search &quot;bar&quot; &quot;foobarbaz&quot;)
3
CL-USER&gt; (mismatch &quot;foobarbaz&quot; &quot;foom&quot;)
3
CL-USER&gt; 
</code></pre>
<h2 id="序列谓词"><a href="#序列谓词" class="headerlink" title="序列谓词"></a>序列谓词</h2><p>EVERY:每个都满足为真</p>
<p>SOME:有一个满足为真</p>
<p>NOTANY:从未满足返回真</p>
<p>NOTEVERY:总是满足返回假</p>
<pre><code>CL-USER&gt; (every #&#39;evenp #(1 2 3 4 5))
NIL
CL-USER&gt; (some #&#39;evenp #(1 2 3 4 5))
T
CL-USER&gt; (notany #&#39;evenp #(1 2 3 4 5))
NIL
CL-USER&gt; (notevery #&#39;evenp #(1 2 3 4 5))
T
CL-USER&gt; (every #&#39;&gt; #(1 2 3 4) #(5 4 3 2))
NIL
CL-USER&gt; (some #&#39;&gt; #(1 2 3 4) #(5 4 3 2))
T
CL-USER&gt; (notany #&#39;&gt; #(1 2 3 4) #(5 4 3 2))
NIL
CL-USER&gt; (notevery #&#39;&gt; #(1 2 3 4) #(5 4 3 2))
T
CL-USER&gt; 
</code></pre>
<h2 id="序列映射函数"><a href="#序列映射函数" class="headerlink" title="序列映射函数"></a>序列映射函数</h2><pre><code>CL-USER&gt; (map &#39;vector #&#39;* #(1 2 3 4 5) #(10 9 8 7 6))
#(10 18 24 28 30)
CL-USER&gt; (reduce #&#39;+ #(1 2 3 4 5 6 7 8 9 10))
55
CL-USER&gt; 
</code></pre>
<p>reduce可以接收的关键字参数:</p>
<p>:key</p>
<p>:from-end</p>
<p>:start</p>
<p>:end</p>
<p>:intial-value</p>
<h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><p>make-hash-table:创建哈希表</p>
<p>gethash:取值</p>
<p>setf:设置</p>
<p>remhash:移除</p>
<p>clrhash:清空</p>
<p>maphash:迭代</p>
<pre><code>CL-USER&gt; (defparameter *h* (make-hash-table))
*H*
CL-USER&gt; (gethash &#39;foo *h*)
NIL
NIL
CL-USER&gt; (setf (gethash &#39;foo *h*) &#39;quux)
QUUX
CL-USER&gt; (gethash &#39;foo *h*)
QUUX
T
CL-USER&gt; 
CL-USER&gt; (maphash #&#39;(lambda (k v) (format t &quot;~a =&gt; ~a~%&quot; k v )) *h*)
FOO =&gt; QUUX
NIL
CL-USER&gt; 
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/plang/lisp/pcldiary/chapter11/" data-id="clhlnylj300xuojup3ihpc7rd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Common-Lisp/" rel="tag">Common Lisp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/plang/lisp/pcldiary/chapter10" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/plang/lisp/pcldiary/chapter10/" class="article-date">
  <time datetime="2017-04-08T14:00:38.000Z" itemprop="datePublished">2017-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/">Lisp</a>►<a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/Common-Lisp/">Common Lisp</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/plang/lisp/pcldiary/chapter10/">第10章 数字和字符串-实用Common Lisp编程笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>lisp支持精确比值。</p>
<p>数字更接近于真正的数学数字。</p>
<p>common lisp整数可以任意大。</p>
<p>整数相除得到一个确切的比值，可以表示任意数度的分数。</p>
<p>common lisp支持复数。</p>
<h2 id="字面数值"><a href="#字面数值" class="headerlink" title="字面数值"></a>字面数值</h2><p>lisp读取器-&gt;lisp求值器</p>
<p>10、20&#x2F;2、#xA读取器会转化为同一个对象。</p>
<pre><code>CL-USER&gt; 10
10
CL-USER&gt; 20/2
10
CL-USER&gt; #xA
10
CL-USER&gt; 
</code></pre>
<p>123</p>
<p>+123</p>
<p>-123</p>
<ol start="123">
<li></li>
</ol>
<p>2&#x2F;3</p>
<p>-2&#x2F;3</p>
<p>4&#x2F;6-&gt;2&#x2F;3</p>
<p>6&#x2F;3-&gt;2</p>
<h3 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h3><p>#b 二进制</p>
<p>#b10101-&gt;21</p>
<p>#b1010&#x2F;1011-&gt;10&#x2F;11</p>
<p>#o 八进制</p>
<p>#o777-&gt;511</p>
<p>#x 十六进制</p>
<p>#xDADA-&gt;56026</p>
<p>#nR n进制</p>
<p>#36rz-35</p>
<h3 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h3><p>数字总是以10进制表示，#x、#b、#o、#r只用于有理数。</p>
<p>1.0-&gt;1.0</p>
<p>1e0-&gt;1.0</p>
<p>1d0-&gt;1.0d0</p>
<p>123.0</p>
<p>123e0</p>
<p>0.123-&gt;0.123</p>
<p>.123-&gt;0.123</p>
<p>123e-3-&gt;0.123</p>
<p>123E-3-&gt;0.123</p>
<p>0.123e20-&gt;1.23e+19</p>
<p>123d23-&gt;1.23d+25</p>
<h3 id="复数"><a href="#复数" class="headerlink" title="复数"></a>复数</h3><p>#c(实部 虚部)</p>
<h3 id="初等数学"><a href="#初等数学" class="headerlink" title="初等数学"></a>初等数学</h3><p>运算符：+ - * &#x2F;</p>
<p>国为&#x2F;不做截断处理，common lisp 提供了4种类型截断和舍入函数。</p>
<p>floor:向负无穷方向截断，返回小于等于实参的最大整数。</p>
<p>ceiling:向正无穷截断。</p>
<p>truncate:向零截断。</p>
<p>round:舍入，中间取偶。</p>
<h3 id="数值比较"><a href="#数值比较" class="headerlink" title="数值比较"></a>数值比较</h3><p>&#x3D; &lt; &gt; &lt;&#x3D; &gt;&#x3D; &#x2F;&#x3D;：可以比较两个或多个值。</p>
<p>max min：可以取最大最小值。</p>
<h2 id="字符"><a href="#字符" class="headerlink" title="字符"></a>字符</h2><p>#\跟想要的字符。</p>
<p>特殊字符跟名称，#\Space,#\Newline。</p>
<h3 id="字符比较"><a href="#字符比较" class="headerlink" title="字符比较"></a>字符比较</h3><p>CHAR&#x3D; CHAR&#x2F;&#x3D; CHAR&lt; CHAR&gt; CHAR&lt;&#x3D; CHAR&gt;&#x3D; :多个参数，大小写相关。</p>
<p>CHAR-EQUAL:多个都相等，大小写无关。</p>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>REPL原样打印字符串，看真实内容用format。</p>
<p>CL-USER&gt; “foo&quot;bar”<br>“foo&quot;bar”<br>CL-USER&gt; (format t “foo&quot;bar”)<br>foo”bar<br>NIL<br>CL-USER&gt; </p>
<p>比较</p>
<p>STRING&#x3D; STRING&#x2F;&#x3D; STRING&lt; STRING&gt; STRING&lt;&#x3D; STRING&gt;&#x3D;</p>
<p>只能比较两个串，因为还有参数。</p>
<p>:start1 :end1 :start2 :end2</p>
<p>左闭右开，指定两个串的起始和结束位置。</p>
<p>所有序列函数都可用于字符串。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/plang/lisp/pcldiary/chapter10/" data-id="clhlnylj200xqojup2141es1g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Common-Lisp/" rel="tag">Common Lisp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/nosql/mongodb/bin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/nosql/mongodb/bin/" class="article-date">
  <time datetime="2017-03-30T14:39:46.000Z" itemprop="datePublished">2017-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nosql/">nosql</a>►<a class="article-category-link" href="/categories/nosql/MongoDB/">MongoDB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/nosql/mongodb/bin/">MongoDB命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>MongoDB安装后主要是一些可执行文件，每个文件都可完成一定的功能。</p>
<p>bsondump.exe</p>
<p><strong>mongo.exe</strong></p>
<p>启动客户端连接，可以执行各种数据库操作。</p>
<p><strong>mongod.exe</strong></p>
<p>启动数据库</p>
<pre><code>mongod.exe --dbpath data\db --rest
</code></pre>
<p><strong>mongodump.exe</strong></p>
<p>用于从mongodb数据库中导出BSON格式的文件，类似于mysql的dump工具mysqldump</p>
<pre><code>mongod.exe --dbpath data\db --rest
</code></pre>
<p><strong>mongoexport.exe</strong></p>
<p>用于将mongodb中的数据库，导出为JSON,CSV或TSV的格式。使用示例：</p>
<pre><code>mongoexport --host mongodb1.example.net --port 37017 --username user --password pass --collection contacts
</code></pre>
<p><strong>mongofiles.exe</strong></p>
<p>用于和mongoDB的GridFS文件系统交互的命令，并可操作其中的文件，它提供了我们本地系统与GridFS文件系统之间的存储对象接口。使用示例：</p>
<pre><code>mongofiles --hostname db1.example.net --port 37017 -d records list
</code></pre>
<p><strong>mongoimport.exe</strong></p>
<p>用于将JSON,CSV或TSV等文件格式，导入到mongoDB数据库中，使用示例：</p>
<pre><code>mongoimport --db users --collection contacts --type csv --file /opt/backups/contacts.csv
</code></pre>
<p><strong>mongooplog.exe</strong></p>
<p> 用于从运行的mongod服务中拷贝运行日志到指定的服务器，主要用于增量备份，使用示例：</p>
<pre><code> mongooplog --from mongodb0.example.net --host mongodb1.example.net
</code></pre>
<p><strong>mongoperf.exe</strong></p>
<p>用于独立检查mongoDB的I&#x2F;O性能的工具，使用示例：</p>
<pre><code>mongoperf.exe &lt; testPrefJson.txt
</code></pre>
<p>注：testPrefJson.txt存放测试的参数，以json格式，如：{nThreads:16,fileSizeMB:1000,r:true}，更多参数参看该命令的帮助，在linux上配置iostat命令观察写入的效果</p>
<p><strong>mongorestore.exe</strong></p>
<p>用于恢复导出的BSON文件到mongodb数据库中</p>
<p><strong>mongos.exe</strong></p>
<p>用于注册系统</p>
<p><strong>mongostat.exe</strong></p>
<p>当前mongod状态监控工具，像linux中监控linux的vmstat</p>
<p><strong>mongotop.exe</strong></p>
<p>提供了一个跟踪mongod数据库花费在读写数据的时间，为每个collection都会记录，默认记录时间是按秒记录。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/nosql/mongodb/bin/" data-id="clhlnylfj00cvojup67c57qb6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/arch/rproxy/httpclient4base" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/arch/rproxy/httpclient4base/" class="article-date">
  <time datetime="2017-03-30T07:17:03.000Z" itemprop="datePublished">2017-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a>►<a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">反向代理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/arch/rproxy/httpclient4base/">反向代理之HttpClient4基本使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="构建NameValue参数"><a href="#构建NameValue参数" class="headerlink" title="构建NameValue参数"></a>构建NameValue参数</h2><pre><code>private static HttpPost buildKvHttpPost(String strUrl,
        Map&lt;String, String&gt; requestParams)
        throws UnsupportedEncodingException &#123;
    List&lt;NameValuePair&gt; nvps = new ArrayList&lt;&gt;();
    for (String strKey : requestParams.keySet()) &#123;
        nvps.add(new BasicNameValuePair(strKey,requestParams.get(strKey)));
    &#125;
    HttpPost post=new HttpPost(strUrl);
    post.setEntity(new UrlEncodedFormEntity(nvps, &quot;UTF-8&quot;));
    return post;
&#125;
</code></pre>
<h2 id="构建Json报文参数"><a href="#构建Json报文参数" class="headerlink" title="构建Json报文参数"></a>构建Json报文参数</h2><pre><code>    private static HttpPost buildJsonHttpPost(String strUrl, String body)
        throws UnsupportedEncodingException &#123;
    StringEntity entity = new StringEntity(body,ContentType.create(&quot;application/json&quot;,&quot;UTF-8&quot;));
    HttpPost post=new HttpPost(strUrl);
    post.setEntity(entity);
    return post;
&#125;
</code></pre>
<h2 id="获取返回结果"><a href="#获取返回结果" class="headerlink" title="获取返回结果"></a>获取返回结果</h2><pre><code>private String getRespString(HttpPost httpPost) throws ParseException, IOException&#123;
    CloseableHttpClient httpClient = HttpClients.createDefault();
    CloseableHttpResponse resp=httpClient.execute(httpPost);
    HttpEntity entity=resp.getEntity();
    ContentType ct=ContentType.getOrDefault(entity);
    String resultStr = EntityUtils.toString(entity , ct.getCharset()).trim();
    System.out.println(resultStr);
    return resultStr;
&#125;
</code></pre>
<h2 id="整体转发请求"><a href="#整体转发请求" class="headerlink" title="整体转发请求"></a>整体转发请求</h2><pre><code>HttpPost httpPost = new HttpPost(servcieUrl);
InputStreamEntity entity = new InputStreamEntity(
        request.getInputStream());
httpPost.setEntity(entity);
for (Enumeration&lt;String&gt; e = request.getHeaderNames(); e
        .hasMoreElements();) &#123;
    String name = e.nextElement().toString();
    if (&quot;Content-Length&quot;.equals(name)) &#123;
        continue;
    &#125;
    httpPost.setHeader(name, request.getHeader(name));
&#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/arch/rproxy/httpclient4base/" data-id="clhlnylfe00c2ojupf8nk9g7n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/arch/rproxy/responsecharset" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/arch/rproxy/responsecharset/" class="article-date">
  <time datetime="2017-03-09T06:42:13.000Z" itemprop="datePublished">2017-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a>►<a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">反向代理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/arch/rproxy/responsecharset/">反向代理之http响应乱码分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="服务器响应测试代码"><a href="#服务器响应测试代码" class="headerlink" title="服务器响应测试代码"></a>服务器响应测试代码</h2><p>UTF-8字符集</p>
<pre><code>response.setHeader(&quot;Content-Type&quot;, &quot;application/json;charset=UTF-8&quot;);
response.getWriter().append(&quot;&#123;\&quot;resp_msg\&quot;:\&quot;查询失败，查询条件不能为空\&quot;,\&quot;resp_code\&quot;:\&quot;9999\&quot;&#125;&quot;);
</code></pre>
<p>GBK字符集</p>
<pre><code>response.setHeader(&quot;Content-Type&quot;, &quot;application/json;charset=GBK&quot;);
response.getWriter().append(&quot;&#123;\&quot;resp_msg\&quot;:\&quot;查询失败，查询条件不能为空\&quot;,\&quot;resp_code\&quot;:\&quot;9999\&quot;&#125;&quot;);
</code></pre>
<h2 id="客户端响应解析代码"><a href="#客户端响应解析代码" class="headerlink" title="客户端响应解析代码"></a>客户端响应解析代码</h2><pre><code>httpClient.executeMethod(postMethod);
String strData=new String(postMethod.getResponseBody());
String strData1=new String(postMethod.getResponseBody(),&quot;UTF-8&quot;);
String strData2=new String(postMethod.getResponseBody(),&quot;GBK&quot;);
String resultStr = postMethod.getResponseBodyAsString();
</code></pre>
<h2 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h2><p><code>postMethod.getResponseBody()</code>会取到响应结果的byte[]数组，创建字符串时只有和<code>response.setHeader</code>中设置的字符集一致才不会乱码。</p>
<p><code>postMethod.getResponseBodyAsString()</code>会自动取响应头<code>Content-Type</code>的编码做字符串解码，所以总是会得到正确的结果。</p>
<p><code>postMethod.getResponseBodyAsString()</code>的内部代码</p>
<pre><code>public String getResponseBodyAsString() throws IOException &#123;
    byte[] rawdata = null;
    if (responseAvailable()) &#123;
        rawdata = getResponseBody();
    &#125;
    if (rawdata != null) &#123;
        return EncodingUtil.getString(rawdata, getResponseCharSet());
    &#125; else &#123;
        return null;
    &#125;
&#125;
public String getResponseCharSet() &#123;
    return getContentCharSet(getResponseHeader(&quot;Content-Type&quot;));
&#125;
</code></pre>
<h2 id="过程分析"><a href="#过程分析" class="headerlink" title="过程分析"></a>过程分析</h2><p>服务器会根据响应头<code>Content-Type</code>的编码对返回字符串做解码，类似<code>str.getBytes(Content-Type响应头编码)</code>。</p>
<p>客户端<code>postMethod</code>从流中取出的byte数组就是服务器解码的数组，要想得到正确的结果就要做<code>new String(byte[],Content-Type响应头编码)</code>生成字符串。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/arch/rproxy/responsecharset/" data-id="clhlnylfd00bzojup0nia5vmu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-blog/arch/rproxy/requestcharset" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/arch/rproxy/requestcharset/" class="article-date">
  <time datetime="2017-03-08T12:31:14.000Z" itemprop="datePublished">2017-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a>►<a class="article-category-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">反向代理</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/arch/rproxy/requestcharset/">反向代理之http请求乱码分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="请求测试代码"><a href="#请求测试代码" class="headerlink" title="请求测试代码"></a>请求测试代码</h2><pre><code>import java.util.HashMap;
import java.util.Map;

import org.apache.commons.httpclient.HttpClient;
import org.apache.commons.httpclient.NameValuePair;
import org.apache.commons.httpclient.methods.PostMethod;

public class HttpCharsetTest &#123;
    public static void main(String[] args) throws Exception &#123;
        String strUrl = &quot;http://localhost:8080/front_new/rproxy/123/456&quot;;
        Map&lt;String, String&gt; requestParams = new HashMap&lt;String, String&gt;();
        requestParams.put(&quot;testkey&quot;, &quot;测试&quot;);
        int i = 0;
        NameValuePair[] nvps = new NameValuePair[requestParams.size()];
        for (String strKey : requestParams.keySet()) &#123;
            NameValuePair nvp = new NameValuePair();
            nvp.setName(strKey);
            nvp.setValue(requestParams.get(strKey));
            nvps[i] = nvp;
            i++;
        &#125;
        PostMethod postMethod = null;
        HttpClient httpClient = new HttpClient();
        // 设置超时时间
        httpClient.getHttpConnectionManager().getParams()
                .setConnectionTimeout(30000);
        httpClient.getHttpConnectionManager().getParams().setSoTimeout(30000);
        postMethod = new PostMethod(strUrl);
        postMethod.setRequestBody(nvps);
//		postMethod.addRequestHeader(&quot;Content-Type&quot;, &quot;text/html;charset=UTF-8&quot;);
//		httpClient.getParams().setContentCharset(&quot;UTF-8&quot;);
//		postMethod.getParams().setContentCharset(&quot;UTF-8&quot;);
        httpClient.executeMethod(postMethod);
        String resultStr = postMethod.getResponseBodyAsString();
        System.err.println(resultStr);
    &#125;
&#125;
</code></pre>
<p>httpClient请求编码设置</p>
<pre><code>postMethod.addRequestHeader(&quot;Content-Type&quot;, &quot;text/html;charset=UTF-8&quot;);
httpClient.getParams().setContentCharset(&quot;UTF-8&quot;);
postMethod.getParams().setContentCharset(&quot;UTF-8&quot;);
</code></pre>
<p>以上三种方式，下面的设置方法会覆盖上面的设置。</p>
<h2 id="内容查看代码"><a href="#内容查看代码" class="headerlink" title="内容查看代码"></a>内容查看代码</h2><p>获取请求完整内容：</p>
<pre><code>byte[] data=IOUtils.readBytesFromStream(request.getInputStream());
String strData=new String(data);
String strDecode=URLDecoder.decode(strData, &quot;UTF-8&quot;);
</code></pre>
<h2 id="内容测试"><a href="#内容测试" class="headerlink" title="内容测试"></a>内容测试</h2><p>不同的httpClient请求编码，参数内容“测试”二字，方式post，<code>strData</code>内容如下：</p>
<pre><code>不设置字符集
testkey=%3F%3F
UTF-8字符集
testkey=%E6%B5%8B%E8%AF%95
GBK字符集
testkey=%B2%E2%CA%D4
</code></pre>
<p>如果不设置字符集，每个汉字编码成占一个字节的编码，没找到任何一个编码与之对应<code>URLDecoder.decode</code>后是乱码。</p>
<p>UTF-8编码成三个字节一个汉字，GBK编码成二个字节一个汉字，用对应编码<code>URLDecoder.decode</code>后都是正常汉字。</p>
<h2 id="获取请求参数"><a href="#获取请求参数" class="headerlink" title="获取请求参数"></a>获取请求参数</h2><p>在获取参数调用<code>request.getParameter</code>前，要设置字符编码：</p>
<pre><code>request.setCharacterEncoding(&quot;UTF-8&quot;);
</code></pre>
<p>可以通过设置spring的filter统一设置编码：</p>
<pre><code>&lt;filter&gt;
  &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
  &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;encoding&lt;/param-name&gt;
    &lt;param-value&gt;UTF-8&lt;/param-value&gt;
  &lt;/init-param&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
  &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
<p>spring的filter的实质：</p>
<pre><code>@Override
protected void doFilterInternal(
        HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
        throws ServletException, IOException &#123;

    if (this.encoding != null &amp;&amp; (this.forceEncoding || request.getCharacterEncoding() == null)) &#123;
        request.setCharacterEncoding(this.encoding);
        if (this.forceEncoding) &#123;
            response.setCharacterEncoding(this.encoding);
        &#125;
    &#125;
    filterChain.doFilter(request, response);
&#125;
</code></pre>
<p>encoding的作用相当于：</p>
<pre><code>request.setCharacterEncoding
</code></pre>
<p>forceEncoding为true的作用相当于：</p>
<pre><code>request.setCharacterEncoding(“”);
response.setCharacterEncoding(“”);
</code></pre>
<h2 id="乱码详解"><a href="#乱码详解" class="headerlink" title="乱码详解"></a>乱码详解</h2><p>一个Http请求的数据大致包括URI、Header、和Body三个部分。这三个部分都需要encoding，不过一般只涉及到URI和Body，因此就不讨论Header了。</p>
<p>GET的请求参数在QueryString中，是URI的一部分。因此，对于GET请求，我们需要关注，URI是如何encoding的？</p>
<p>POST的请求参数在Body中，因此，对于POST请求，我们则需要关注，Body是如何encoding的？</p>
<p>麻烦的是，URI和Body的charset还可以不一样，使用不同的方法进行设置和配置。</p>
<h2 id="Tomcat如何设置charset"><a href="#Tomcat如何设置charset" class="headerlink" title="Tomcat如何设置charset"></a>Tomcat如何设置charset</h2><p>Tomcat通过URI的charset来设置QueryString的charset。我们可以在Tomcat根目录下conf&#x2F;server.xml 中进行配置。</p>
<pre><code>&lt;Connector
URIEncoding=&quot;UTF-8&quot;
useBodyEncodingForURI=&quot;true&quot; 
acceptCount=&quot;100&quot;
connectionTimeout=&quot;20000&quot;
disableUploadTimeout=&quot;true&quot;
enableLookups=&quot;false&quot;
maxHttpHeaderSize=&quot;8192&quot;
maxSpareThreads=&quot;75&quot;
maxThreads=&quot;150&quot;
minSpareThreads=&quot;25&quot;
port=&quot;8080&quot;
redirectPort=&quot;8443&quot;/&gt;
</code></pre>
<p>URIEncoding属性就是URI的charset，上述配置表示 Tomcat认为URI的charset就是UTF-8。如果HttpClient也使用UTF-8作为QueryString的charset，那么Tomcat就可以正确decoding。详情可以参考org.apache.tomcat.util.http.Parameters类的handleQueryParameters的方法。</p>
<p>Tomcat在启动的过程中，如果从conf&#x2F;server.xml中读取到URIEncoding属性，就会设置queryStringEncoding的值。当Tomcat处理HTTP请求时，上述方法就会被调用。</p>
<p>默认的server.xml是没有配置URIEncoding属性的，需要我们手动设置 。如果没有设置，Tomcat就会采用一种称为“fast conversion”的方式解析QueryString。详情可以参考org.apache.tomcat.util.http.Parameter类的urlDecode方法。</p>
<p>useBodyEncodingForURI是与URI charset相关的另一个属性。如果该属性的值为true，则Tomcat将使用Body的charset作为URI的charset。如果Tomcat没有设置Body的charset，那么将使用HTTP请求Content-Type Header中的charset。如果HTTP请求中没有设置Content-Type Header，则使用ISO-8859-1作为默认charset。详情参见org.apache.catalina.connector.Request的parseParmeters方法</p>
<p>默认的server.xml是没有配置useBodyEncodingForURI属性的，需要我们手动设置 。如果没有设置，Tomcat则认为其值为false。需要注意的是，如果URIEncoding和useBodyEncodingForURI同时设置，而且Body的charset已经设置，那么将以Body的charset为准 。</p>
<p>设置POST请求Body的charset：</p>
<p>设置Body charset的方法很简单，只要调用javax.servlet.ServletRequest接口的setCharacterEncoding方法即可，比如request.setCharacterEncoding(“UTF-8”)。需要注意的是，该方法必须在读取任何请求参数之前调用，才有效果。</p>
<p>也就是说，我们只有在调用getParameter或getReader方法之前，调用setsetCharacterEncoding方法，设置的charset才能奏效。</p>
<p>响应数据的charset：</p>
<p>设置响应数据charset的方法很简单，只要调用javax.servlet.ServletResponse接口的setContentType或setCharacterEncoding方法即可，比如response.setContentType(“text&#x2F;html;charset&#x3D;UTF-8”)或response.setCharacterEncoding(“UTF-8”)。</p>
<p>如果Servlet正确设置了响应数据的charset，那么HTTP响应数据中就会包含Content-Type Header。HttpClient的getResponseBodyAsString方法就可以正确decoding响应数据。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.onekbase.com/blog/arch/rproxy/requestcharset/" data-id="clhlnylff00c5ojup6oxwbmpp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><a class="extend next" rel="next" href="/page/8/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA-WEB/">JAVA WEB</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA-WEB/Spring-Boot/">Spring Boot</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB%E5%BC%80%E5%8F%91/">WEB开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/">nosql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/MongoDB/">MongoDB</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/">基础</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9F%BA%E7%A1%80/%E5%AD%97%E7%AC%A6%E9%9B%86/">字符集</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/spark/">spark</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/Emacs/">Emacs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/GIT/">GIT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/VIM/">VIM</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">自制操作系统</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/SSO/">SSO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E4%B8%80%E8%87%B4%E6%80%A7/">一致性</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/">任务调度</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">反向代理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E5%AF%86%E7%A0%81%E6%9C%AF/">密码术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/JMS/">JMS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E7%BB%84%E4%BB%B6/">组件</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">负载均衡</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/">知识体系</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/">排序</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E6%A0%91%E7%AE%97%E6%B3%95/">树算法</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C%E8%AF%AD%E8%A8%80/">C语言</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/">JAVA</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/BASE/">BASE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/IO/">IO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/JAVA8/">JAVA8</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/NIO/">NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/JAVA/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/">线程安全</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/">Lisp</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Lisp/Common-Lisp/">Common Lisp</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Scala/">Scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/">javascript</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASCII%E7%A0%81/" rel="tag">ASCII码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ActiveMQ/" rel="tag">ActiveMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ajax/" rel="tag">Ajax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BAT%E8%84%9A%E6%9C%AC/" rel="tag">BAT脚本</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/" rel="tag">CAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAS/" rel="tag">CAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Common-Lisp/" rel="tag">Common Lisp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag">C语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emacs/" rel="tag">Emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emmet/" rel="tag">Emmet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/" rel="tag">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IPFS/" rel="tag">IPFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA-IO/" rel="tag">JAVA IO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA-NIO/" rel="tag">JAVA NIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA-WEB/" rel="tag">JAVA WEB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA8/" rel="tag">JAVA8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lisp/" rel="tag">Lisp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scala/" rel="tag">Scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shiro/" rel="tag">Shiro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot/" rel="tag">Spring Boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-MVC/" rel="tag">Spring MVC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/" rel="tag">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VIM/" rel="tag">VIM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WEB%E5%BC%80%E5%8F%91/" rel="tag">WEB开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/" rel="tag">XML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/archtype/" rel="tag">archtype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/azkaban/" rel="tag">azkaban</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/" rel="tag">hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/" rel="tag">hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jquery/" rel="tag">jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nosql/" rel="tag">nosql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nosql-neo4j/" rel="tag">nosql neo4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/" rel="tag">openssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servlet/" rel="tag">servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/" rel="tag">spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webservice/" rel="tag">webservice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7/" rel="tag">一致性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/" rel="tag">任务调度</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag">分布式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">区块链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" rel="tag">字符编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E7%AC%A6%E9%9B%86/" rel="tag">字符集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%A1%E8%AE%A1/" rel="tag">审计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%86%E7%A0%81%E6%9C%AF/" rel="tag">密码术</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%BE%E9%80%92%E5%BD%92/" rel="tag">尾递归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95/" rel="tag">摘要算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" rel="tag">数字签名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6/" rel="tag">数字证书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/" rel="tag">数据权限</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9D%82%E8%B0%88/" rel="tag">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%91%E7%AE%97%E6%B3%95/" rel="tag">树算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AD%A3%E8%A7%84%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">正规表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">消息队列</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="tag">知识体系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A5%9E%E5%99%A8/" rel="tag">神器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" rel="tag">线程安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">自制操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" rel="tag">负载均衡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%94%81/" rel="tag">锁</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AOP/" style="font-size: 10.5px;">AOP</a> <a href="/tags/ASCII%E7%A0%81/" style="font-size: 10px;">ASCII码</a> <a href="/tags/ActiveMQ/" style="font-size: 11px;">ActiveMQ</a> <a href="/tags/Ajax/" style="font-size: 10px;">Ajax</a> <a href="/tags/BAT%E8%84%9A%E6%9C%AC/" style="font-size: 10px;">BAT脚本</a> <a href="/tags/CAP/" style="font-size: 10px;">CAP</a> <a href="/tags/CAS/" style="font-size: 10.5px;">CAS</a> <a href="/tags/Common-Lisp/" style="font-size: 13.5px;">Common Lisp</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 10.5px;">C语言</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Emacs/" style="font-size: 16.5px;">Emacs</a> <a href="/tags/Emmet/" style="font-size: 10px;">Emmet</a> <a href="/tags/GIT/" style="font-size: 10px;">GIT</a> <a href="/tags/HttpClient/" style="font-size: 12.5px;">HttpClient</a> <a href="/tags/IPFS/" style="font-size: 10px;">IPFS</a> <a href="/tags/JAVA/" style="font-size: 20px;">JAVA</a> <a href="/tags/JAVA-IO/" style="font-size: 15.5px;">JAVA IO</a> <a href="/tags/JAVA-NIO/" style="font-size: 17px;">JAVA NIO</a> <a href="/tags/JAVA-WEB/" style="font-size: 10.5px;">JAVA WEB</a> <a href="/tags/JAVA8/" style="font-size: 13.5px;">JAVA8</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Lisp/" style="font-size: 12px;">Lisp</a> <a href="/tags/Markdown/" style="font-size: 10.5px;">Markdown</a> <a href="/tags/MongoDB/" style="font-size: 18px;">MongoDB</a> <a href="/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/tags/Scala/" style="font-size: 11px;">Scala</a> <a href="/tags/Shiro/" style="font-size: 10px;">Shiro</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/Spring-MVC/" style="font-size: 10px;">Spring MVC</a> <a href="/tags/UML/" style="font-size: 10px;">UML</a> <a href="/tags/VIM/" style="font-size: 16px;">VIM</a> <a href="/tags/WEB%E5%BC%80%E5%8F%91/" style="font-size: 11px;">WEB开发</a> <a href="/tags/XML/" style="font-size: 10.5px;">XML</a> <a href="/tags/archtype/" style="font-size: 10px;">archtype</a> <a href="/tags/azkaban/" style="font-size: 10.5px;">azkaban</a> <a href="/tags/hadoop/" style="font-size: 13px;">hadoop</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/hive/" style="font-size: 10px;">hive</a> <a href="/tags/javascript/" style="font-size: 14px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/linux/" style="font-size: 13px;">linux</a> <a href="/tags/maven/" style="font-size: 12px;">maven</a> <a href="/tags/nosql/" style="font-size: 18.5px;">nosql</a> <a href="/tags/nosql-neo4j/" style="font-size: 11.5px;">nosql neo4j</a> <a href="/tags/openssl/" style="font-size: 11px;">openssl</a> <a href="/tags/servlet/" style="font-size: 11px;">servlet</a> <a href="/tags/spark/" style="font-size: 12px;">spark</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/webservice/" style="font-size: 11px;">webservice</a> <a href="/tags/%E4%B8%80%E8%87%B4%E6%80%A7/" style="font-size: 11.5px;">一致性</a> <a href="/tags/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/" style="font-size: 10.5px;">任务调度</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">分布式</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 10px;">区块链</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 17.5px;">大数据</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" style="font-size: 10px;">字符编码</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E9%9B%86/" style="font-size: 12.5px;">字符集</a> <a href="/tags/%E5%AE%A1%E8%AE%A1/" style="font-size: 10px;">审计</a> <a href="/tags/%E5%AF%86%E7%A0%81%E6%9C%AF/" style="font-size: 14.5px;">密码术</a> <a href="/tags/%E5%B0%BE%E9%80%92%E5%BD%92/" style="font-size: 10px;">尾递归</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 12px;">并发</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 14px;">排序</a> <a href="/tags/%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95/" style="font-size: 10px;">摘要算法</a> <a href="/tags/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D/" style="font-size: 10.5px;">数字签名</a> <a href="/tags/%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6/" style="font-size: 10px;">数字证书</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 18.5px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90/" style="font-size: 10px;">数据权限</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 11.5px;">杂谈</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 13.5px;">架构</a> <a href="/tags/%E6%A0%91%E7%AE%97%E6%B3%95/" style="font-size: 14px;">树算法</a> <a href="/tags/%E6%AD%A3%E8%A7%84%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 10px;">正规表达式</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 10px;">消息队列</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" style="font-size: 12px;">知识体系</a> <a href="/tags/%E7%A5%9E%E5%99%A8/" style="font-size: 12px;">神器</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 18.5px;">算法</a> <a href="/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" style="font-size: 19px;">线程安全</a> <a href="/tags/%E8%87%AA%E5%88%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 12.5px;">自制操作系统</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 19.5px;">设计模式</a> <a href="/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" style="font-size: 13px;">负载均衡</a> <a href="/tags/%E9%94%81/" style="font-size: 11px;">锁</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2999/12/">十二月 2999</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">九月 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">二月 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">九月 2009</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/explain/">【置顶】特别说明</a>
          </li>
        
          <li>
            <a href="/blog/tools/maven/dn-cst-maven-archtype/">开发一个maven脚手架</a>
          </li>
        
          <li>
            <a href="/blog/nosql/neo4j/neo4jindustrystock/">neo4j创建行业与股票关系</a>
          </li>
        
          <li>
            <a href="/blog/nosql/neo4j/neo4jindustry/">neo4j创建三级行业关系</a>
          </li>
        
          <li>
            <a href="/blog/nosql/neo4j/neo4jtimeline/">neo4j创建时间线</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 证心<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>